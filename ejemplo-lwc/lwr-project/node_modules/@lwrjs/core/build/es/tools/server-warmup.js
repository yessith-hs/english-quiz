import SiteGenerator from './static-generation.js';
import { skipDirCreation } from './utils/dir.js';
import NetworkDispatcher from './utils/network-dispatcher.js';
import { explodeMode } from '../env-config.js';
export async function warmupServer(config, internalRequestKey) {
    console.log('[Server Warmup] starting');
    const { routes, staticSiteGenerator, port, apiVersion, basePath, lwrVersion, serverMode } = config;
    staticSiteGenerator.outputDir = skipDirCreation;
    const urlRewriteMap = new Map();
    const runtimeEnvironment = {
        ...explodeMode(serverMode),
        apiVersion,
        basePath,
        lwrVersion,
        debug: false,
        serverMode,
    };
    // For each locale, generate all the modules
    await new SiteGenerator().generateRoutes(runtimeEnvironment, staticSiteGenerator, routes, new NetworkDispatcher(port, internalRequestKey), staticSiteGenerator.outputDir, urlRewriteMap);
    console.log('[Server Warmup] complete');
}
//# sourceMappingURL=server-warmup.js.map